# QCM Workspace - Quality Control Management

## Purpose
Document review and approval system for construction submittals.
Implements USACE QCM standards for submittal processing.

## Layout Structure
```
+-------------------+--------------------+-------------------+
|                   |                    |                   |
|  Project          |  Report            |  Trajanus EI      |
|  Documents        |  Templates         |  (Claude AI)      |
|                   |                    |                   |
| - File upload     | - Template list    | - Review          |
| - Browse Drive    | - Reference docs   | - Analysis        |
| - Multi-select    | - QCM standards    | - Generation      |
|                   |                    |                   |
+-------------------+--------------------+-------------------+
```

## Code Locations (index.html)

### Styles
- **QCM Styles**: Lines 768-850
- CSS class prefix: `.qcm-*`

### HTML Structure
- **QCM Workspace Container**: Lines 2838-2922
- **QCM Toolkit Section**: Lines 2550-2560
- **QCM Tools Buttons**: Lines 2559-2590

### JavaScript Functions
- `openQCMWorkspace()` - Lines 5746-5764, 6909-6927
- `loadQCMFilesInTab(tabId)` - Line 6934
- `setupQCMEventListenersInTab(tabId)` - Referenced in openQCMWorkspace
- `toggleQCMFileSelection(fileId)` - Line 6943
- `saveQCMSetup()` - Line 2916
- `loadQCMSetup()` - Line 2919
- `clearQCMWorkspace()` - Line 2922

## Current Status

### Completed
- 3-panel layout structure
- File browser modal (opens Drive files)
- Multi-select file capability
- Basic UI styling (brown/orange theme)
- Integration with Google Drive API

### In Progress
- Template reference system
- Review engine integration
- Save to deliverables functionality

### Planned
- Automated review generation via Claude API
- Template customization
- Multi-document batch processing
- Agency-specific workflows (USACE, NAVFAC, AFCEC)

## File Upload Workflow
1. User clicks "Upload Documents" button
2. File modal opens with Google Drive browser
3. User navigates folders, filters by type
4. Supported filters: .pdf, .docx, .gdoc, .md
5. User selects files (multi-select enabled)
6. Files display in Project Documents panel
7. Ready for review processing

## Template System (Design)
1. Load templates from Supabase KB
2. Display in Template panel (middle column)
3. User selects applicable template
4. Template populates review criteria
5. Ready for Claude review generation

## Review Engine (Design)
1. User selects uploaded docs + template
2. Clicks "Generate Review" in Trajanus EI panel
3. Claude API call with:
   - Document content
   - Template requirements
   - QCM standards
   - Agency-specific rules
4. Generated review displays in right panel
5. User can edit/approve
6. Save to Client Deliverables folder

## QCM Standards Reference
- USACE ER 1180-1-6: Construction Quality Management
- EM 385-1-1: Safety and Health Requirements
- UFC 1-300-09: Sustainability Design and Development

## Integration Points

### Google Drive
- `electronAPI.listDirectory()` - Browse folders
- `electronAPI.uploadFile()` - Upload to workspace
- `electronAPI.readFile()` - Get file contents

### Supabase KB
- `supabase.from('documents').select()` - Template lookup
- `supabase.from('knowledge_base').select()` - Reference docs

### Claude API (Planned)
- Review generation
- Document analysis
- Compliance checking

## Known Issues
- File picker z-index occasionally conflicts with other modals
- Multi-select needs visual feedback improvement
- Template loading not yet implemented
- No batch processing capability yet

## DO NOT
- Remove file upload capability
- Change 3-panel layout
- Break existing file browser
- Modify color scheme without approval
- Delete working functions

## Color Scheme (Must Match Main App)
```css
--brown-dark: #1f1410;
--brown-mid: #3d2a1f;
--orange-light: #e8922a;
--cream: #FFF8F0;
```

## Next Steps (Priority Order)
1. Implement template reference browser
2. Connect Supabase KB for template retrieval
3. Build Claude API integration for reviews
4. Create save-to-deliverables function
5. Add batch processing capability
6. Agency-specific template variants

## Testing Checklist
- [ ] Open QCM workspace from sidebar
- [ ] Browse Google Drive files
- [ ] Select multiple files
- [ ] Files appear in left panel
- [ ] Template panel displays (when implemented)
- [ ] Review generation works (when implemented)
- [ ] Save to deliverables works (when implemented)

---

**Last Updated**: 2025-12-19
**Code Location**: index.html lines 768-850 (styles), 2838-2922 (HTML), 5746-6943 (JS)
**Status**: Active Development - Phase 1 Complete
