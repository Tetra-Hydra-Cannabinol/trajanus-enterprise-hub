<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trajanus Enterprise Hub</title>
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <div class="app-wrapper">
        <!-- Header Bar -->
        <header class="header-bar">
            <div class="header-brand">
                <span class="header-logo">&#9670;</span>
                <span class="header-title">TRAJANUS</span>
            </div>
            <div class="header-controls">
                <button class="header-icon-btn" title="Settings">&#9881;</button>
                <button class="header-icon-btn" title="User">&#128100;</button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Hero Title -->
            <section class="hero-title">
                <h1>TRAJANUS ENTERPRISE HUB <span class="trademark">| EI&#8482;</span></h1>
            </section>

            <!-- Greeting Row -->
            <div class="greeting-row">
                <h2 class="greeting">
                    <span id="greeting-text">Good morning</span>, <span class="greeting-name">Bill</span>.
                </h2>
                <span class="current-date" id="current-date">December 29, 2025</span>
            </div>

            <!-- Welcome Section -->
            <section class="welcome-section">
                <h2 class="welcome-title">Welcome to the Trajanus Enterprise Hub</h2>
                <p class="welcome-intro">
                    The Enterprise Hub is your central command interface for construction project management,
                    quality control, traffic engineering, and development operations. Built on Trajanus
                    Engineered Intelligence (EI&#8482;), this platform integrates federal contract management
                    workflows with AI-assisted tools and automation.
                </p>
            </section>

            <!-- Platforms Section -->
            <section class="platforms-section">
                <div class="section-header">
                    <h2 class="section-title">Platforms</h2>
                </div>

                <div class="platforms-grid">
                    <!-- Project Management -->
                    <a href="toolkits/pm.html" class="platform-card">
                        <h3 class="platform-title">Project Management</h3>
                        <p class="platform-description">
                            Integrated scheduling, cost tracking, and document control for federal construction contracts.
                            Connects to Primavera P6, Procore, and Corps of Engineers systems.
                        </p>
                        <div class="platform-tags">
                            <span class="platform-tag">Procore</span>
                            <span class="platform-tag">P6</span>
                            <span class="platform-tag">RMS</span>
                        </div>
                    </a>

                    <!-- Quality Control -->
                    <a href="toolkits/qcm.html" class="platform-card">
                        <h3 class="platform-title">Quality Control</h3>
                        <p class="platform-description">
                            Submittal processing, inspection documentation, and deficiency tracking.
                            Interfaces with RMS 3.0 and generates QC reports for USACE compliance.
                        </p>
                        <div class="platform-tags">
                            <span class="platform-tag">RMS 3.0</span>
                            <span class="platform-tag">QC Logs</span>
                        </div>
                    </a>

                    <!-- Traffic Studies -->
                    <a href="toolkits/traffic.html" class="platform-card">
                        <h3 class="platform-title">Traffic Studies</h3>
                        <p class="platform-description">
                            Traffic impact analysis and study generation. Processes data from Synchro, HCS,
                            and field counts to produce jurisdiction-compliant reports.
                        </p>
                        <div class="platform-tags">
                            <span class="platform-tag">Synchro</span>
                            <span class="platform-tag">HCS</span>
                        </div>
                    </a>

                    <!-- Developer Toolkit -->
                    <a href="toolkits/developer.html" class="platform-card">
                        <h3 class="platform-title">Developer Toolkit</h3>
                        <p class="platform-description">
                            Session management, script execution, and AI-assisted development.
                            Central control for file conversion, automation, and Claude integration.
                        </p>
                        <div class="platform-tags">
                            <span class="platform-tag">Claude</span>
                            <span class="platform-tag">Scripts</span>
                        </div>
                    </a>
                </div>
            </section>

            <!-- Active Projects -->
            <section class="projects-section">
                <div class="section-header">
                    <h2 class="section-title">Active Projects</h2>
                </div>

                <div class="projects-grid">
                    <div class="project-card">
                        <div class="project-name">SOUTHCOM Guatemala</div>
                        <div class="project-subtitle">Infrastructure</div>
                        <div class="project-divider"></div>
                        <div class="project-details">
                            Contract: W9127823R0034<br>
                            Value: $47.2M<br>
                            Type: Federal Construction
                            <div class="project-status">
                                <span class="status-dot active"></span>
                                <span>Active - Day 847</span>
                            </div>
                        </div>
                    </div>

                    <div class="project-card">
                        <div class="project-name">Grace Fellowship</div>
                        <div class="project-subtitle">Traffic Study</div>
                        <div class="project-divider"></div>
                        <div class="project-details">
                            Client: Grace Fellowship Church<br>
                            Type: Traffic Impact Analysis
                            <div class="project-status">
                                <span class="status-dot active"></span>
                                <span>Active</span>
                            </div>
                        </div>
                    </div>

                    <div class="project-card">
                        <div class="project-name">Base Housing - Kwajalein</div>
                        <div class="project-subtitle">Military Housing</div>
                        <div class="project-divider"></div>
                        <div class="project-details">
                            Location: Kwajalein Atoll, Marshall Islands<br>
                            Type: Military Housing
                            <div class="project-status">
                                <span class="status-dot planning"></span>
                                <span>Planning</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Quick Tools -->
            <section class="quick-tools-section">
                <div class="section-header">
                    <h2 class="section-title">Quick Tools</h2>
                </div>

                <div class="quick-tools-grid">
                    <div class="quick-tool" onclick="Hub.launchTool('md-to-docs')">
                        <div class="quick-tool-icon">&#128196;</div>
                        <div class="quick-tool-label">MD to Docs</div>
                    </div>
                    <div class="quick-tool" onclick="Hub.launchTool('xer-parse')">
                        <div class="quick-tool-icon">&#128202;</div>
                        <div class="quick-tool-label">XER Parse</div>
                    </div>
                    <div class="quick-tool" onclick="Hub.launchTool('converter')">
                        <div class="quick-tool-icon">&#128260;</div>
                        <div class="quick-tool-label">Converter</div>
                    </div>
                    <div class="quick-tool" onclick="Hub.launchTool('browser')">
                        <div class="quick-tool-icon">&#128193;</div>
                        <div class="quick-tool-label">Browser</div>
                    </div>
                </div>
            </section>

            <!-- Claude Assistant -->
            <section class="claude-section">
                <div class="section-header">
                    <h2 class="section-title">Claude Assistant</h2>
                </div>

                <div class="chat-container">
                    <div class="chat-header">
                        <h3>Claude Assistant</h3>
                        <div class="chat-actions">
                            <button class="chat-action" onclick="Chat.clear()">Clear</button>
                        </div>
                    </div>
                    <div class="chat-messages" id="chatMessages">
                        <div class="chat-welcome">
                            Welcome to the Trajanus Claude Assistant. Ask questions about your projects,
                            get help with tasks, or start a conversation.
                        </div>
                    </div>
                    <div class="chat-input-area">
                        <textarea id="chatInput" placeholder="Message Claude..." rows="1" onkeydown="Chat.handleKeydown(event)"></textarea>
                        <button class="tool-button primary" id="sendBtn" onclick="Chat.send()">Send</button>
                    </div>
                    <div class="chat-footer">
                        <a href="toolkits/developer.html">Open Full Chat in Developer Toolkit &#8594;</a>
                    </div>
                </div>
            </section>

            <!-- Applications -->
            <section class="applications-section">
                <div class="section-header">
                    <h2 class="section-title">Applications</h2>
                </div>

                <div class="applications-grid">
                    <div class="app-category">
                        <h4>Federal & DoD</h4>
                        <ul class="app-list">
                            <li><a href="https://rms.usace.army.mil" target="_blank" class="app-link"><span class="app-link-icon">&#9670;</span> RMS 3.0</a></li>
                            <li><a href="https://cefms.usace.army.mil" target="_blank" class="app-link"><span class="app-link-icon">&#9670;</span> CEFMS</a></li>
                            <li><a href="#" class="app-link"><span class="app-link-icon">&#9670;</span> ENG Form 4025</a></li>
                            <li><a href="#" class="app-link"><span class="app-link-icon">&#9670;</span> eCMS</a></li>
                        </ul>
                    </div>

                    <div class="app-category">
                        <h4>Project Controls</h4>
                        <ul class="app-list">
                            <li><a href="#" class="app-link"><span class="app-link-icon">&#9670;</span> Primavera P6</a></li>
                            <li><a href="https://app.procore.com" target="_blank" class="app-link"><span class="app-link-icon">&#9670;</span> Procore</a></li>
                            <li><a href="#" class="app-link"><span class="app-link-icon">&#9670;</span> Oracle Unifier</a></li>
                            <li><a href="#" class="app-link"><span class="app-link-icon">&#9670;</span> Microsoft Project</a></li>
                        </ul>
                    </div>

                    <div class="app-category">
                        <h4>Communication</h4>
                        <ul class="app-list">
                            <li><a href="https://teams.microsoft.com" target="_blank" class="app-link"><span class="app-link-icon">&#9670;</span> Microsoft Teams</a></li>
                            <li><a href="https://outlook.office.com" target="_blank" class="app-link"><span class="app-link-icon">&#9670;</span> Outlook</a></li>
                            <li><a href="https://zoom.us" target="_blank" class="app-link"><span class="app-link-icon">&#9670;</span> Zoom</a></li>
                            <li><a href="https://claude.ai" target="_blank" class="app-link"><span class="app-link-icon">&#9670;</span> Claude AI</a></li>
                        </ul>
                    </div>

                    <div class="app-category">
                        <h4>Documentation</h4>
                        <ul class="app-list">
                            <li><a href="https://drive.google.com" target="_blank" class="app-link"><span class="app-link-icon">&#9670;</span> Google Drive</a></li>
                            <li><a href="#" class="app-link"><span class="app-link-icon">&#9670;</span> SharePoint</a></li>
                            <li><a href="#" class="app-link"><span class="app-link-icon">&#9670;</span> Bluebeam Revu</a></li>
                            <li><a href="https://github.com" target="_blank" class="app-link"><span class="app-link-icon">&#9670;</span> GitHub</a></li>
                        </ul>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <span class="footer-item">Trajanus USA</span>
            <span class="footer-item">High Springs, FL</span>
            <span class="footer-item">v0.4.0</span>
            <span class="footer-item footer-status">
                <span class="status-dot active"></span>
                Connected
            </span>
        </footer>
    </div>

    <script>
        // Tauri API
        const { invoke } = window.__TAURI__.core;

        // Hub Controller
        const Hub = {
            init() {
                this.updateGreeting();
                this.updateDate();
            },

            updateGreeting() {
                const hour = new Date().getHours();
                let greeting = 'Good evening';
                if (hour < 12) greeting = 'Good morning';
                else if (hour < 17) greeting = 'Good afternoon';
                document.getElementById('greeting-text').textContent = greeting;
            },

            updateDate() {
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                const date = new Date().toLocaleDateString('en-US', options);
                document.getElementById('current-date').textContent = date;
            },

            async launchTool(tool) {
                const SCRIPTS_PATH = 'G:\\My Drive\\00 - Trajanus USA\\00-Command-Center\\05-Scripts\\';

                switch(tool) {
                    case 'md-to-docs':
                        try {
                            await invoke('run_python_script', {
                                scriptPath: SCRIPTS_PATH + 'CONVERT_MD_TO_GDOCS_PERMANENT.py'
                            });
                        } catch(e) {
                            console.error('Failed to launch MD to Docs:', e);
                        }
                        break;
                    case 'xer-parse':
                        console.log('XER Parse - Coming soon');
                        break;
                    case 'converter':
                        window.location.href = 'toolkits/developer.html';
                        break;
                    case 'browser':
                        try {
                            await invoke('run_python_script', {
                                scriptPath: SCRIPTS_PATH + 'SCRIPT_BROWSER.py'
                            });
                        } catch(e) {
                            console.error('Failed to launch browser:', e);
                        }
                        break;
                }
            }
        };

        // Chat Controller
        const Chat = {
            messages: [],
            isStreaming: false,

            async send() {
                const input = document.getElementById('chatInput');
                const message = input.value.trim();
                if (!message || this.isStreaming) return;

                // Add user message
                this.addMessage('user', message);
                input.value = '';

                // Show typing indicator
                this.isStreaming = true;
                document.getElementById('sendBtn').disabled = true;
                const typingEl = this.showTyping();

                try {
                    const response = await invoke('chat_with_claude', {
                        message: message,
                        context: 'You are Claude, an AI assistant embedded in the Trajanus Enterprise Hub. This is a command center for construction project management. Be helpful, concise, and professional.'
                    });

                    typingEl.remove();
                    this.addMessage('assistant', response);
                } catch (error) {
                    typingEl.remove();
                    this.addMessage('assistant', 'Error connecting to Claude. Please try again.');
                    console.error('Chat error:', error);
                }

                this.isStreaming = false;
                document.getElementById('sendBtn').disabled = false;
            },

            addMessage(role, content) {
                const container = document.getElementById('chatMessages');

                // Remove welcome message if present
                const welcome = container.querySelector('.chat-welcome');
                if (welcome) welcome.remove();

                const msgEl = document.createElement('div');
                msgEl.className = `message ${role}`;
                msgEl.innerHTML = `<div class="message-content">${this.formatMessage(content)}</div>`;
                container.appendChild(msgEl);
                container.scrollTop = container.scrollHeight;

                this.messages.push({ role, content });
            },

            formatMessage(text) {
                // Basic markdown: bold, code blocks, inline code
                return text
                    .replace(/```(\w*)\n?([\s\S]*?)```/g, '<pre><code>$2</code></pre>')
                    .replace(/`([^`]+)`/g, '<code>$1</code>')
                    .replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>')
                    .replace(/\n/g, '<br>');
            },

            showTyping() {
                const container = document.getElementById('chatMessages');
                const typing = document.createElement('div');
                typing.className = 'typing-indicator';
                typing.innerHTML = '<span></span><span></span><span></span>';
                container.appendChild(typing);
                container.scrollTop = container.scrollHeight;
                return typing;
            },

            handleKeydown(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    this.send();
                }
            },

            clear() {
                const container = document.getElementById('chatMessages');
                container.innerHTML = `
                    <div class="chat-welcome">
                        Welcome to the Trajanus Claude Assistant. Ask questions about your projects,
                        get help with tasks, or start a conversation.
                    </div>
                `;
                this.messages = [];
            }
        };

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            Hub.init();
        });
    </script>
</body>
</html>
