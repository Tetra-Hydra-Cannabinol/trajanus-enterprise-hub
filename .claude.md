# Trajanus Command Center - Claude Code Context

**Version:** 1.0  
**Created:** 2026-01-17  
**Purpose:** Auto-loaded context for every Claude Code session  
**DO NOT EDIT THIS FILE DIRECTLY - Use version control**

---

## PROJECT OVERVIEW

**Name:** Trajanus Command Center (Enterprise Hub)  
**Type:** Desktop application (Tauri 2.0)  
**Purpose:** Construction project management platform for federal contracts  
**Owner:** Bill King / Trajanus Systems  
**Primary User:** Bill (remote PM), Tom Chlebanowski (partner, PE Civil/JD)

**Mission:**
Transform traditional construction PM through systematic AI integration. Remote delivery of USACE Design-Build contracts while maintaining quality standards.

**Current Project:**
SOUTHCOM Guatemala (W9127823R0034) - January 2026 completion deadline

---

## ARCHITECTURE

**Frontend:** HTML/CSS/JavaScript (single-file index.html architecture)  
**Backend:** Tauri 2.0 (Rust)  
**Database:** Supabase PostgreSQL with pgvector (337+ documents)  
**Storage:** Google Drive (G:\My Drive\00 - Trajanus USA\)  
**Tools:** Playwright MCP, Sub-agents, Custom commands  

**Tech Stack:**
- Tauri 2.0.2 (desktop framework)
- Vanilla JS (no frameworks - intentional simplicity)
- Supabase (knowledge base + authentication)
- OpenAI API (embeddings: text-embedding-3-small)
- Google Drive API (file management)
- yt-dlp (YouTube content acquisition)

---

## SACRED FILES (NEVER EDIT DIRECTLY)

**Critical Rule:** These files are NEVER edited directly by Claude Code. Violations have destroyed working builds multiple times.

### src/index.html
- **Status:** Sacred - contains entire working application
- **Edit Protocol:** Create versioned copy ONLY
  ```
  WRONG: Edit src/index.html directly
  RIGHT: Copy to index_v2.1_FEATURE.html ‚Üí edit ‚Üí test ‚Üí replace
  ```
- **Why:** Single file architecture - any corruption breaks entire app
- **Last Incident:** 2026-01-11 - Logo integration destroyed 5-6 times

### src-tauri/src/lib.rs
- **Status:** Sacred - Rust backend
- **Edit Protocol:** CC has safeguards, DO NOT override them
- **Why:** Tauri compilation dependencies
- **Rule:** If CC blocks edit, it's correct - find another way

**Backup Before ANY Change:**
```bash
timestamp=$(date +%Y%m%d_%H%M%S)
cp src/index.html "archive/index_${timestamp}_BACKUP.html"
```

---

## FILE STRUCTURE

### Development Locations
```
C:\Dev\trajanus-command-center\     ‚Üê Tauri development ONLY
  ‚îú‚îÄ‚îÄ src/
  ‚îÇ   ‚îî‚îÄ‚îÄ index.html                 ‚Üê Sacred file
  ‚îú‚îÄ‚îÄ src-tauri/
  ‚îÇ   ‚îî‚îÄ‚îÄ src/lib.rs                 ‚Üê Sacred file
  ‚îú‚îÄ‚îÄ .claude.md                     ‚Üê This file
  ‚îú‚îÄ‚îÄ .claude/
  ‚îÇ   ‚îú‚îÄ‚îÄ agents/                    ‚Üê Sub-agents
  ‚îÇ   ‚îú‚îÄ‚îÄ commands/                  ‚Üê Custom commands
  ‚îÇ   ‚îú‚îÄ‚îÄ context/                   ‚Üê Supporting docs
  ‚îÇ   ‚îî‚îÄ‚îÄ workflows/                 ‚Üê Process guides
  ‚îú‚îÄ‚îÄ changelog.md                   ‚Üê Decision log
  ‚îî‚îÄ‚îÄ plan.md                        ‚Üê Task tracking

G:\My Drive\00 - Trajanus USA\      ‚Üê ALL operational files
  ‚îú‚îÄ‚îÄ 00-Command-Center/
  ‚îÇ   ‚îú‚îÄ‚îÄ 01-Core-Protocols/         ‚Üê Master documents
  ‚îÇ   ‚îú‚îÄ‚îÄ 05-Scripts/                ‚Üê Python/PowerShell automation
  ‚îÇ   ‚îú‚îÄ‚îÄ 08-EOS-Files/              ‚Üê Session documentation
  ‚îÇ   ‚îî‚îÄ‚îÄ 13-Knowledge-Base/         ‚Üê YouTube archive + transcripts
  ‚îú‚îÄ‚îÄ 01-Morning-Sessions/
  ‚îú‚îÄ‚îÄ 02-Daily-Operations/
  ‚îî‚îÄ‚îÄ [other operational folders]

/home/claude/                        ‚Üê Temporary workspace
  ‚îî‚îÄ‚îÄ [scratchpad only - not persistent]
```

**CRITICAL PATH RULES:**
- ‚úÖ Tauri dev work: C:\Dev\trajanus-command-center\ ONLY
- ‚úÖ All other work: G:\My Drive\00 - Trajanus USA\
- ‚ùå FORBIDDEN: C:\Users\owner\Downloads\
- ‚ùå FORBIDDEN: npm operations on Google Drive (causes TAR errors)

---

## BRANDING STANDARDS

**Colors (EXACT - Do not vary):**
- Primary Silver: `#C0C0C0`
- Primary Black: `#1a1a1a`
- Primary Blue: `#0066CC`
- **NO GOLD** unless explicitly requested by Bill

**UI Layout Standard:**
- 3-column layout: `[sidebar | main content | processing log]`
- Header text: "TRAJANUS USA" (centered)
- Return button: "‚Üê Hub" (top-left)
- Mode tabs: Horizontal below header
- Border: 4px solid #0066CC (thick blue border on all tool windows)

**Typography:**
- Font family: Roboto (all weights)
- Header: Roboto Bold
- Body: Roboto Regular
- Code: Roboto Mono

**DESIGN REFERENCE FILES:**
- **Design Principles:** `.claude/context/design_principles.md` (243 lines, 98+ guidelines)
- **Style Guide:** `.claude/context/style_guide.md` (760 lines, complete CSS specifications)
- **Visual Examples:** `.playwright-mcp/` (90+ screenshots of correct implementations)

**Before ANY UI work, read:**
1. design_principles.md - Core philosophy, decision framework
2. style_guide.md - Exact CSS values, good/bad examples
3. Verify with Playwright screenshots

**ACCEPTANCE CRITERIA TEMPLATES:**
- `.claude/templates/ui_feature_template.md` - UI changes validation
- `.claude/templates/api_integration_template.md` - API/Supabase integration
- `.claude/templates/database_change_template.md` - Schema modifications
- `.claude/templates/tool_addition_template.md` - New tools/scripts

**Before ANY task, copy appropriate template and fill in criteria.**

---

## KEY DECISIONS (See changelog.md for details)

**Technology Migrations:**
- **Electron ‚Üí Tauri** (Nov 2024): Cross-platform, lighter, better security
- **Markdown ‚Üí Google Docs** (Dec 2025): Claude can actually read Google Docs format
- **Single-file ‚Üí Component architecture** (Rejected): Maintaining simplicity

**Development Rules Established:**
- **npm on Google Drive = FORBIDDEN**: Causes file locking, TAR errors
- **Surgical Edits Only**: Never rewrite entire files
- **Backup Before Major Changes**: Catastrophe recovery kit required
- **Test After Every Change**: No exceptions
- **Hub-and-Spoke Protocol**: CP plans, CC executes

**Disasters & Recoveries:**
- 2026-01-11: Logo integration - 5-6 build destructions before Sacred File Protocol v2.0
- 2025-12-13: Electron binary corruption - recovered via reinstall
- 2025-12-XX: Supabase RPC assumption - functions didn't exist, wasted hours

---

## DEVELOPMENT PROTOCOLS

### Surgical Edit Principle
```
‚ùå WRONG:
  - Rewrite entire file
  - "Let me refactor this whole section"
  - Generate new version from scratch

‚úÖ RIGHT:
  - Edit specific function only
  - Preserve surrounding code exactly
  - Test change immediately
  - Document why change was made
```

### Testing Requirements
**After EVERY code change:**
1. `npm start` - verify app launches
2. Navigate to affected section
3. Test functionality manually
4. Check console for errors
5. Screenshot with Playwright (if UI change)
6. Only then commit

### Version Control Pattern
```bash
# Before ANY significant work
git checkout -b feature/description
git add .
git commit -m "Descriptive message following pattern"

# Commit message format:
[CATEGORY] Brief description
- Bullet point details
- Why change was made
- What was tested
```

### Backup Strategy
**Before touching Sacred Files:**
```bash
# Create timestamped backup
timestamp=$(date +%Y%m%d_%H%M%S)
cp src/index.html "G:\My Drive\00 - Trajanus USA\09-Backups\index_${timestamp}_BEFORE_FEATURE.html"
```

**Catastrophe Recovery Kit:**
- Working executable (from last successful build)
- HTML source (last known good)
- Git commit hash
- Store in: G:\My Drive\00 - Trajanus USA\09-Backups\WORKING-YYYY-MM-DD-HHMM\

---

## COMMON PATTERNS

### How to Add QCM Category
1. Locate: `src/index.html` ‚Üí Search for `qcm-categories`
2. Backup file first
3. Add category object to array:
   ```javascript
   {
     id: 'category-7',
     name: 'New Category Name',
     description: 'Category purpose',
     checklist: [/* items */]
   }
   ```
4. Update UI rendering logic
5. Test QCM workspace loads
6. Verify category appears in dropdown

### How to Integrate Supabase Query
1. **VERIFY SCHEMA FIRST** - Never assume
   ```sql
   SELECT column_name, data_type 
   FROM information_schema.columns 
   WHERE table_name = 'your_table';
   ```
2. Test query in Supabase SQL editor
3. Document actual schema vs. assumptions
4. Create standalone test script
5. Only then integrate into main.js

### How to Add Workspace Tab
1. Update navigation HTML (add tab button)
2. Create workspace content section
3. Add CSS for workspace styling
4. Implement JavaScript show/hide logic
5. Test tab switching
6. Verify Playwright screenshots

### How to Create Custom Tool
1. Create Python script in G:\...\05-Scripts\
2. Add to Hub Dev Page as card
3. Implement launch function
4. Test from Hub click
5. Document in tool spec file

---

## TESTING & VALIDATION

### Manual Testing Checklist
- [ ] App launches without errors (`npm start`)
- [ ] All tabs/workspaces accessible
- [ ] No console errors (F12)
- [ ] Branding colors correct (#C0C0C0, #1a1a1a, #0066CC)
- [ ] 3-column layout maintained
- [ ] Responsive behavior acceptable
- [ ] Performance < 100ms for interactions

### Playwright Validation (When Installed)
```javascript
// Auto-triggered on UI changes
1. Launch app
2. Navigate to affected pages
3. Screenshot: Desktop (1920√ó1080), Tablet (768√ó1024), Mobile (375√ó667)
4. Compare to style guide
5. If issues: fix and repeat
6. If valid: commit
```

### Unit Testing (Future)
```bash
npm test
```

---

## WHEN IN DOUBT

**Decision Tree:**
1. **Is there a past decision in changelog.md?** ‚Üí Follow that precedent
2. **Is it a Sacred File?** ‚Üí DO NOT edit directly, use versioned copy
3. **Does it require architecture change?** ‚Üí Ask Planner (CP), don't decide alone
4. **Is it specialized work?** ‚Üí Use sub-agent (design-reviewer, qcm-reviewer, etc.)
5. **Is it high risk (>500 lines)?** ‚Üí Use GSD Framework (Explore ‚Üí Plan ‚Üí Execute ‚Üí Validate)
6. **Unsure?** ‚Üí Backup, test on copy, ask for clarification

**Red Flags:**
- "Let me refactor this whole section" ‚Üí STOP, surgical edits only
- "I'll rewrite this file" ‚Üí STOP, Sacred File Protocol
- "This should work" ‚Üí STOP, test before claiming success
- Editing npm on G: drive ‚Üí STOP, forbidden operation

---

## KNOWLEDGE SOURCES

**Before saying "I don't know":**
1. Search this .claude.md file
2. Check workspace-specific .claude.md
3. Read changelog.md for similar past decisions
4. Search project knowledge base (286 chunks from video transcripts)
5. Check context folder (.claude/context/)

**KB Search Topics:**
- GSD framework
- Planner/Developer workflow
- Playwright MCP usage
- Sub-agent patterns
- .claude.md best practices

---

## COMMUNICATION WITH BILL

**Style:** Direct, warm, professional equals  
**No:** Platitudes, over-explaining, ambiguity  
**Yes:** Action over explanation, real examples, clear structure  

**Token Gauge Required:**
Every response ends with:
```
Token Gauge: üü¢ XX% remaining (green: 20-100%)
Token Gauge: üü° XX% remaining (yellow: 5-20%)
Token Gauge: üî¥ XX% remaining (red: <5%)
```

**Foreign Phrases Welcome:**
Include translation in parentheses

**Acknowledgment Format:**
"Tracking" / "Copy that" / "Understood" + brief summary

---

## WORKSPACES

The application has 4 primary workspaces:

### 1. QCM Workspace
- **Purpose:** Quality Control Management for submittals
- **Location:** `src/index.html` ‚Üí Search `qcm-workspace`
- **Categories:** 6-category system (Submittal, Testing, Inspection, Deficiency, Documentation, Acceptance)
- **Details:** See `qcm-workspace/.claude.md`

### 2. PM Toolkit
- **Purpose:** Project management tools and dashboards
- **Location:** `src/index.html` ‚Üí Search `pm-toolkit`
- **Tools:** Schedule analysis, cost tracking, resource management
- **Details:** See `pm-toolkit/.claude.md`

### 3. Traffic Study Engine (TSE)
- **Purpose:** USACE traffic study requirements automation
- **Location:** `src/index.html` ‚Üí Search `tse-workspace`
- **Tools:** Study templates, requirement checklists
- **Details:** See `tse-workspace/.claude.md`

### 4. Developer Project
- **Purpose:** Development tools, KB browser, script management
- **Location:** `src/index.html` ‚Üí Search `developer-project`
- **Tools:** YouTube Library, KB browser, automation scripts
- **Details:** See `developer-project/.claude.md`

---

## INTEGRATION POINTS

### Supabase Knowledge Base
- **Database:** PostgreSQL with pgvector
- **Table:** knowledge_base
- **Chunks:** 286 (as of 2026-01-17)
- **Content:** Video transcripts, documentation, guides
- **Access:** Direct table queries (NOT RPC - learned from past failure)

### Google Drive
- **Root:** G:\My Drive\00 - Trajanus USA\
- **Access:** Via Google Drive API
- **Format:** All docs must be Google Docs format (Claude can't read MD from Drive)
- **Conversion:** Use CONVERT_AND_APPEND.ps1 for MD ‚Üí GDOC

### YouTube Archive
- **Location:** 13-Knowledge-Base/Videos/ and /Transcripts/
- **Index:** archive_index.json (master tracking)
- **GUI:** KB_Video_Browser_WORKING_2025-12-23.pyw
- **Integration:** Dev Page card launches browser

---

## TROUBLESHOOTING

### App Won't Launch
1. Check if Tauri dev server running
2. Verify `npm start` from correct directory (C:\Dev\trajanus-command-center\)
3. Check for node_modules corruption
4. Review console output for specific error

### Electron Binary Corrupted
**Symptoms:** Stub files in node_modules/electron/dist/  
**Fix:** Full reinstall
```bash
rm -rf node_modules
npm install
```

### Google Drive Sync Issues
**Symptom:** File changes not appearing  
**Fix:** Check Google Drive Desktop sync status  
**Note:** Never run npm on synced folders

### Supabase Connection Fails
1. Verify .env file exists at G:\...\00-Command-Center\.env
2. Check SUPABASE_URL and SUPABASE_ANON_KEY
3. Test connection with standalone script first
4. Verify RLS policies if using SERVICE_KEY

### Build Failures
1. Restore from last known good backup
2. Check git diff to see what changed
3. Revert suspicious changes
4. Test incrementally

---

## NEXT STEPS AFTER READING THIS

**You should now understand:**
- Project architecture and purpose
- Sacred File Protocol (CRITICAL)
- File structure and path rules
- Branding standards
- Development protocols
- Testing requirements
- Common patterns for frequent tasks

**Your first actions:**
1. Read workspace-specific .claude.md for your current task
2. Read changelog.md to understand past decisions
3. Check plan.md for current task status
4. Review context files (.claude/context/) for design standards
5. Begin work following protocols above

**Remember:**
- Surgical edits only
- Backup before major changes
- Test after every change
- Update changelog.md with decisions
- Token gauge in every response

---

**For detailed workflows, see:**
- .claude/workflows/gsd_framework.md (Explore ‚Üí Plan ‚Üí Execute ‚Üí Validate)
- .claude/workflows/planner_developer.md (Hub-and-Spoke pattern)
- .claude/workflows/visual_validation.md (Playwright iteration loop)
- .claude/workflows/context_management.md (Rewind at 5% protocol)

**Last Updated:** 2026-01-17  
**Version:** 1.0  
**Maintainer:** Bill King via Claude Code sessions
