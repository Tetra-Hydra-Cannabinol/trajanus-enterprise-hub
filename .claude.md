# Trajanus Command Center - Enterprise Hub

## Project Overview
Electron desktop application for construction project management.
Principal: Bill King, 30+ years DoD construction experience.
Mission: AI-augmented PM workflows for federal construction.

## Technology Stack
- Frontend: Electron + HTML/CSS/JavaScript (vanilla)
- Backend: Python (automation scripts, Google Drive API)
- Database: Supabase PostgreSQL + pgvector (knowledge base)
- Storage: Google Drive (file management)
- Deployment: Local desktop application

## Architecture
```
G:\My Drive\00 - Trajanus USA\00-Command-Center\
├── index.html              # Main application (~7,200 lines, 332KB)
├── main.js                 # Electron main process (10KB)
├── renderer.js             # Electron renderer process
├── preload.js              # Electron security bridge (4.5KB)
├── package.json            # Dependencies
├── .claude/                # Claude Code settings
├── 05-Scripts/             # Python automation
│   ├── google_drive_manager.py
│   ├── file_ingestion.py
│   └── research_agent.py
├── agents/                 # AI agents
│   └── morning_research_agent.py
├── services/               # Backend services
│   └── kb-service.js
├── assets/                 # Images, icons
├── 04-Documentation/       # Project docs
└── node_modules/           # Dependencies (LOCAL COPY ONLY!)
```

## Critical File Locations

### index.html Structure (7,200+ lines)
- **CSS Variables/Colors**: Lines 12-25
- **Sidebar Styles**: Lines 44-100
- **QCM Styles**: Lines 768-850
- **Main HTML Content**: Lines 2000+
- **QCM Workspace HTML**: Lines 2838-2922
- **JavaScript Functions**: Lines 4700+
- **QCM Functions**: Lines 5746-5764, 6909-6943
- **Event Listeners**: Lines 6800+

### Key JavaScript Files
- `main.js` - Electron main process, IPC handlers
- `preload.js` - Security bridge, window.electronAPI
- `supabase_browser.js` - KB browser class (19KB)
- `gdrive_browser.js` - Google Drive browser (19KB)

## Startup Process
1. Requirements: Node.js installed, Google Drive Desktop synced
2. Navigate to: C:\trajanus-command-center\ (LOCAL, not Drive!)
3. Install dependencies: `npm install` (first time only)
4. Start application: `npm start`
5. Application opens in Electron window
6. Hard reload if needed: Ctrl+Shift+R

## Color Scheme (Brand Identity)
```css
:root {
    --brown-dark: #1f1410;
    --brown-mid: #3d2a1f;
    --brown-light: #5c4033;
    --cream: #FFF8F0;
    --orange-dark: #a85a1b;
    --orange-mid: #cc6e1f;
    --orange-light: #e8922a;
    --tan: #d4a574;
    --gray-dark: #2d2622;
    --gray-mid: #4a413a;
    --gray-light: #a89890;
    --green-badge: #28a745;
}
```

## Design Patterns
- **3-Panel Layout**: All workspaces use Left|Middle|Right structure
- **Modal Pattern**: File selection, settings, forms
- **Card Pattern**: Task items, document cards
- **Tab Navigation**: Workspace switching
- **Tool Sections**: Grouped by function with headers

## Known Issues & Critical Rules

### NEVER DO THIS:
1. **npm in Google Drive**: NEVER run npm commands in G:\My Drive folders
   - Causes: Sync conflicts, file corruption, node_modules bloat
   - Solution: Development in C:\trajanus-command-center\
   - Production: Copy to G:\My Drive manually

2. **Rewrite Working Functions**: Don't touch working code without explicit reason
   - Use: Surgical edits with str_replace
   - Avoid: Complete function rewrites

3. **Change Established UI**: Maintain color scheme and layout patterns
   - Users expect: Brown/orange theme, 3-panel layout
   - Don't: Introduce new colors or layouts without approval

4. **Remove Functionality**: Don't delete working features
   - Add: New capabilities
   - Don't: Break existing workflows

### ALWAYS DO THIS:
1. **Backup Before Changes**: Create timestamped copy before major edits
2. **Test After Changes**: `npm start` and verify functionality
3. **Use Existing APIs**: electronAPI methods already exist, use them
4. **Follow Patterns**: Match existing code style and structure
5. **Ask Before Breaking Changes**: Question mark protocol (?)

## Current Development Status

### Completed
- Command Center interface (77 applications organized)
- QCM workspace (basic structure in index.html)
- Developer workspace (file tools, utilities)
- Google Drive integration
- Supabase KB connection (1,805 documents)
- TKB Browser modal
- Dual browser system (Supabase + GDrive)
- Morning research agent

### In Progress
- QCM Review Engine (template-based document review)
- .claude.md context system
- GitHub collaboration with Chris Bochman

### Planned
- Playwright MCP integration (UI validation)
- Agency-specific templates (USACE, NAVFAC, AFCEC)
- White-label configuration system
- Commercial deployment preparation

## File Management Protocol

### Source Files (Editable)
Location: C:\trajanus-command-center\
Format: .html, .js, .py, .json, .md
Purpose: Development and version control

### Runtime Files (Application)
Location: G:\My Drive\00 - Trajanus USA\00-Command-Center\
Format: Same as source
Purpose: Electron loads from here
Sync: Manual copy from C:\ to G:\

### Living Documents (Session Records)
Location: G:\My Drive\00 - Trajanus USA\03-Living-Documents\
Format: .md -> .docx -> .gdoc (three versions)
Purpose: Session continuity, Claude memory

## Google Drive Folder Structure
```
00 - Trajanus USA/
├── 00-Command-Center/        # Application files (YOU ARE HERE)
├── 01-Morning-Sessions/      # Daily startup docs
├── 02-Daily-Diary/           # Bill's journal
├── 03-Living-Documents/      # Session records
├── 04-Session-Journal/       # Technical logs
├── 05-Code-Repository/       # Scripts and tools
├── 06-Protocols/             # Operating procedures
├── 07-Client-Deliverables/   # Output for clients
└── [continues through 12]
```

## Integration Points

### Supabase
- Project: qhtglwrdfnmjpqvhhcxl
- Tables: documents, chunks, knowledge_base
- Connection: Client in preload.js
- Queries: Direct table access (NOT RPC)
- Documents: 1,805 in knowledge base

### Google Drive API
- Authentication: OAuth via electronAPI
- Operations: List, read, upload, download
- File Types: All (.pdf, .docx, .gdoc, .md, code files)

### MCP Servers (Active)
- Playwright: UI validation and testing
- Trajanus-KB: Knowledge base search

## Helpful Commands
- Start app: `npm start` (from C:\trajanus-command-center\)
- Install deps: `npm install`
- Hard reload: Ctrl+Shift+R in app
- Clear context: ESC ESC (in Claude Code)

## QCM Workspace Quick Reference
- **Open**: Click "QCM Toolkit" in sidebar, then "Submittal Review"
- **HTML Location**: index.html lines 2838-2922
- **Functions**: openQCMWorkspace(), loadQCMFilesInTab(), setupQCMEventListenersInTab()
- **Styles**: Lines 768-850 in index.html

## Best Practices
1. Read this .claude.md FIRST when starting work
2. Check changelog.md for recent decisions
3. Review plan.md for current tasks
4. Use existing patterns - don't reinvent
5. Update this file when architecture changes

---

**Last Updated**: 2025-12-19 by Claude Opus 4.5
**Maintained By**: Bill King + Claude collaboration
**Status**: Living Document - Update as project evolves
